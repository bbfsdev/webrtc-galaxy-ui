<!DOCTYPE html>
<html>
	<head>
		<title>Initiator</title>
		<script src="/RTCMultiConnection-v1.8.js" type="text/javascript"></script>
        <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon"> 
	</head>
	<body>
        <p><video autoplay></video></p>

		<script>
			//window.skipRTCMultiConnectionLogs = true;
			var stream;
			var channelid = 'BB-Group-Video';
			var video = document.querySelector('video');
            var connection;

            connection = new RTCMultiConnection(channelid);
            connection.isInitiator = true;
            connection.sessionid = 'virtual-group';
            connection.autoReDialOnFailure = true;
            connection.session = {};

            // We do accept remote video stream
            connection.sdpConstraints.mandatory = {
                OfferToReceiveAudio: false,
                OfferToReceiveVideo: true
            };

            // On getting local or remote media stream
            connection.onstream = function(e) {
                console.log("New stream: ", e);
                video.src = URL.createObjectURL(e.stream);
                video.play();
                stream = e.stream;
            };

            connection.onopen = function(e) {
                console.log("Connection opened, ", e);
                connection.session = {video: true};
            }

            connection.onstatechange = function (state, reason) {
                console.log("State changed: ", state, reason);
            }

            connection.onleave = function(e) {
                /*if (!!stream) {
                    video.src = null;
                    stream.stop('remote');
                    stream = null;
                }*/
                console.log("User left: ", e);
            }

            connection.onSessionClosed = function(e) {
                console.log("Session closed,", e);
            }

            connection.onerror = function(e) {
                console.log("Error occured,", e);
            }

            connection.onclose = function(e) {
                console.log("Connection closed.");
            }

			window.onbeforeunload = connection.close;

            // Setup signalling channel
            connection.open();
            console.log("Connection opened.");
		</script>

	</body>
</html>

